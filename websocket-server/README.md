# WebSocket Server –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–Ω–∞—Ç

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–∞ Next.js + TypeScript –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–Ω–∞—Ç.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd websocket-server
npm install
```

### 2. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å —Ç–µ—Å—Ç–∞–º–∏
```bash
npm test
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- Next.js —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8081
- WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8080
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8081 –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `npm test` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:
1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –æ–±—â–µ–π –∫–æ–º–Ω–∞—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
4. –¢–µ—Å—Ç WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞
5. –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ `../realtime-ws-test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ò–∑–º–µ–Ω–∏—Ç–µ URL –Ω–∞ `ws://localhost:8080`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–º–Ω–∞—Ç** - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- **WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥** - —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ TypeScript
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∏–¥–Ω–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
websocket-server/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketServer.ts    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VirtualUser.ts        # –ö–ª–∞—Å—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ api/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ websocket.ts      # API endpoint
‚îÇ       ‚îî‚îÄ‚îÄ index.tsx             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ test-server.js                # –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ package.json
```

## üö¢ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä
pkill -f signaling

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
scp -r websocket-server root@89.23.115.156:/root/TelegramVoice/
```

### 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
cd /root/TelegramVoice/websocket-server
npm install
npm run build
npm start
```

### 3. PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
pm2 start npm --name "websocket-server" -- start
pm2 save
pm2 startup
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- WebSocket –ø–æ—Ä—Ç: 8080 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `WebSocketServer.ts`)
- Next.js –ø–æ—Ä—Ç: 8081 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `package.json`)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞: http://localhost:8081
- –õ–æ–≥–∏: –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞
- PM2 –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `pm2 monit`