#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ dev —Ä–µ–∂–∏–º–µ

set -e

echo "üîß –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ TelegramVoice..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
cd mini-app
npm install

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Rust
echo "ü¶Ä –ü—Ä–æ–≤–µ—Ä–∫–∞ Rust –ø—Ä–æ–µ–∫—Ç–∞..."
cd ../signaling-server
cargo check

# –í–æ–∑–≤—Ä–∞—Ç –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ..

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git —Ö—É–∫–æ–≤
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git —Ö—É–∫–æ–≤..."
if [ -f "setup-hooks.sh" ]; then
    chmod +x setup-hooks.sh
    ./setup-hooks.sh
else
    echo "‚ö†Ô∏è  setup-hooks.sh –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ö—É–∫–æ–≤"
fi

echo "‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!"
echo ""
echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "  Frontend: cd mini-app && npm run dev"
echo "  Backend:  cd signaling-server && cargo run"
echo ""
echo "üìù Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:"
echo "  1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ"
echo "  2. git add . && git commit -m '–æ–ø–∏—Å–∞–Ω–∏–µ' (—Å –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–±–æ—Ä–∫–∏)"
echo "  3. git push origin main"
echo "  4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: ./deploy.sh"