'use client';

import React, { useState, useEffect, useCallback } from 'react';
import { –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ö–æ–º–Ω–∞—Ç–∞, –°–æ—Å—Ç–æ—è–Ω–∏–µ–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è } from '@/types';
import { useTelegramWebApp } from '@/hooks/useTelegramWebApp';
import { useSocket } from '@/hooks/useSocket';
import { useSettings } from '@/hooks/useSettings';
import { SimpleRoomsList } from '@/components/SimpleRoomsList';
import { SimpleVoiceRoom } from '@/components/SimpleVoiceRoom';
import { SettingsPage } from '@/components/SettingsPage';
import { DebugModal } from '@/components/DebugModal';
import { useDebugConsole } from '@/hooks/useDebugConsole';
import { v4 as uuidv4 } from 'uuid';

export default function Home() {
  const [—Å–æ—Å—Ç–æ—è–Ω–∏–µ, set–°–æ—Å—Ç–æ—è–Ω–∏–µ] = useState<–°–æ—Å—Ç–æ—è–Ω–∏–µ–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è>({
    —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: null,
    –∫–æ–º–Ω–∞—Ç—ã: [],
    –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: null,
    –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: false,
    —Å–æ—Å—Ç–æ—è–Ω–∏–µ_–º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: true,
    –≥—Ä–æ–º–∫–æ—Å—Ç—å: 50,
    –æ—à–∏–±–∫–∞: null,
    –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: true,
  });

  const [–ø–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, set–ü–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏] = useState(false);
  const [–º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É, set–ú–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É] = useState(false);
  
  // Debug console —Ö—É–∫
  const { –ø–æ–∫–∞–∑–∞—Ç—å_–æ—Ç–ª–∞–¥–∫—É, –∑–∞–∫—Ä—ã—Ç—å_–æ—Ç–ª–∞–¥–∫—É } = useDebugConsole();

  // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  useEffect(() => {
    // –ê–ø–ø –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
  }, []);

  // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —ç–∫—Ä–∞–Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–¥–∞–µ–º –≤—Ä–µ–º—è WebSocket –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è)
  useEffect(() => {
    const timer = setTimeout(() => {
      console.log(`[page.tsx] ‚è∞ –ò—Å—Ç–µ–∫–ª–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ - —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –æ—à–∏–±–∫–∏`);
      set–ú–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É(true);
    }, 2000); // 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∞

    return () => clearTimeout(timer);
  }, []);

  // –ê–í–ê–†–ò–ô–ù–´–ô —Ç–∞–π–º–µ—Ä –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –≤—Å—ë –∑–∞–≤–∏—Å–ª–æ
  useEffect(() => {
    const emergencyTimer = setTimeout(() => {
      console.log(`[page.tsx] üö® –ê–í–ê–†–ò–ô–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–ª–æ!`);
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
      if (!—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) {
        console.log(`[page.tsx] üÜò –°–æ–∑–¥–∞—ë–º –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`);
        const –∞–≤–∞—Ä–∏–π–Ω—ã–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {
          id: uuidv4(),  
          –∏–º—è: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_${Math.random().toString(36).substr(2, 5)}`,
          –ø–æ–¥–∫–ª—é—á–µ–Ω: true,
          –º–∏–∫—Ä–æ—Ñ–æ–Ω_–≤–∫–ª—é—á–µ–Ω: true,
          –≥–æ–≤–æ—Ä–∏—Ç: false,
        };
        
        set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({
          ...prev,
          —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∞–≤–∞—Ä–∏–π–Ω—ã–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
          –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: false,
        }));
      }
    }, 5000); // 5 —Å–µ–∫—É–Ω–¥ –∞–≤–∞—Ä–∏–π–Ω—ã–π —Ç–∞–π–º–µ—Ä

    return () => clearTimeout(emergencyTimer);
  }, []); // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
  
  const { 
    –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, 
    –∑–∞–≥—Ä—É–∂–µ–Ω–æ: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–∑–∞–≥—Ä—É–∂–µ–Ω—ã, 
    —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏,
    –ø–æ–ª—É—á–∏—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ 
  } = useSettings();

  const {
    –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
    –≥–æ—Ç–æ–≤: —Ç–µ–ª–µ–≥—Ä–∞–º_–≥–æ—Ç–æ–≤,
    –≤–µ—Ä—Å–∏—è: —Ç–µ–ª–µ–≥—Ä–∞–º_–≤–µ—Ä—Å–∏—è,
    –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è,
    –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ,
    –ø–æ–∫–∞–∑–∞—Ç—å–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ,
    –ø–æ–∫–∞–∑–∞—Ç—å–í—Å–ø–ª—ã–≤–∞—é—â–µ–µ–û–∫–Ω–æ,
    –≤–∏–±—Ä–∞—Ü–∏—è
  } = useTelegramWebApp();

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö Telegram
  useEffect(() => {
    console.log(`[page.tsx] üë§ useEffect —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:`, {
      —Ç–µ–ª–µ–≥—Ä–∞–º_–≥–æ—Ç–æ–≤,
      —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: !!—Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
      —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: !!—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    });
    
    if (—Ç–µ–ª–µ–≥—Ä–∞–º_–≥–æ—Ç–æ–≤ && —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å && !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) {
      console.log(`[page.tsx] üìù –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram –¥–∞–Ω–Ω—ã—Ö`);
      const –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {
        id: uuidv4(),
        –∏–º—è: `${—Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.first_name}${—Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.last_name ? ` ${—Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.last_name}` : ''}`,
        —Ç–µ–ª–µ–≥—Ä–∞–º_id: —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.id,
        –∞–≤–∞—Ç–∞—Ä: —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.photo_url,
        –ø–æ–¥–∫–ª—é—á–µ–Ω: true,
        –º–∏–∫—Ä–æ—Ñ–æ–Ω_–≤–∫–ª—é—á–µ–Ω: true,
        –≥–æ–≤–æ—Ä–∏—Ç: false,
      };

      console.log(`[page.tsx] ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω:`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–º—è);
      set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({
        ...prev,
        —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
        –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: false,
      }));
    } else if (—Ç–µ–ª–µ–≥—Ä–∞–º_–≥–æ—Ç–æ–≤ && !—Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å && !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) {
      // –°–æ–∑–¥–∞–µ–º –≥–æ—Å—Ç–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ Telegram –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
      console.log(`[page.tsx] üëª –°–æ–∑–¥–∞—ë–º –≥–æ—Å—Ç–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`);
      const –≥–æ—Å—Ç–µ–≤–æ–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {
        id: uuidv4(),
        –∏–º—è: `–ì–æ—Å—Ç—å_${Math.random().toString(36).substr(2, 5)}`,
        –ø–æ–¥–∫–ª—é—á–µ–Ω: true,
        –º–∏–∫—Ä–æ—Ñ–æ–Ω_–≤–∫–ª—é—á–µ–Ω: true,
        –≥–æ–≤–æ—Ä–∏—Ç: false,
      };

      console.log(`[page.tsx] ‚úÖ –ì–æ—Å—Ç–µ–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω:`, –≥–æ—Å—Ç–µ–≤–æ–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–º—è);
      set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({
        ...prev,
        —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≥–æ—Å—Ç–µ–≤–æ–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
        –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: false,
      }));
    } else {
      console.log(`[page.tsx] ‚è∏Ô∏è –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å–æ–∑–¥–∞–Ω`);
    }
  }, [—Ç–µ–ª–µ–≥—Ä–∞–º_–≥–æ—Ç–æ–≤, —Ç–µ–ª–µ–≥—Ä–∞–º_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]);

  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π WebSocket URL - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó
  const [webSocketURL] = useState(() => {
    console.log(`[page.tsx] üåê –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ WebSocket URL (–û–î–ò–ù –†–ê–ó)...`);
    console.log(`[page.tsx] üîß NEXT_PUBLIC_WEBSOCKET_URL:`, process.env.NEXT_PUBLIC_WEBSOCKET_URL);
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
    if (process.env.NEXT_PUBLIC_WEBSOCKET_URL) {
      console.log(`[page.tsx] ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:`, process.env.NEXT_PUBLIC_WEBSOCKET_URL);
      return process.env.NEXT_PUBLIC_WEBSOCKET_URL;
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ URL
    if (typeof window !== 'undefined') {
      const isHTTPS = window.location.protocol === 'https:';
      const hostname = window.location.hostname;
      console.log(`[page.tsx] üåç –¢–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω:`, {
        protocol: window.location.protocol,
        hostname: hostname,
        isHTTPS: isHTTPS,
        fullURL: window.location.href
      });
      
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        const url = 'ws://localhost:8080';
        console.log(`[page.tsx] üè† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, URL:`, url);
        return url;
      }
      
      if (hostname === '89.23.115.156') {
        const url = isHTTPS ? 'wss://hesovoice.online/ws' : 'ws://89.23.115.156:8080';
        console.log(`[page.tsx] üñ•Ô∏è IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞, URL:`, url);
        return url;
      }
      
      if (hostname === 'hesovoice.online') {
        const url = isHTTPS ? 'wss://hesovoice.online/ws' : 'ws://hesovoice.online/ws';
        console.log(`[page.tsx] üåê –î–æ–º–µ–Ω hesovoice.online, URL:`, url);
        return url;
      }
      
      console.log(`[page.tsx] ‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –¥–æ–º–µ–Ω: ${hostname}`);
    }
    
    const fallbackUrl = 'ws://localhost:8080';
    console.log(`[page.tsx] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback URL:`, fallbackUrl);
    return fallbackUrl;
  });
  console.log(`[page.tsx] üéõÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è useSocket —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:`, {
    —Å–µ—Ä–≤–µ—ÄUrl: webSocketURL,
    –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ? {
      id: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.id,
      –∏–º—è: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–º—è
    } : null
  });

  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–±—ç–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–π
  const –Ω–∞_–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ_–∫–æ–º–Ω–∞—Ç = useCallback((–∫–æ–º–Ω–∞—Ç—ã: –ö–æ–º–Ω–∞—Ç–∞[]) => {
    console.log(`[page.tsx] üè† –ü–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã:`, –∫–æ–º–Ω–∞—Ç—ã);
    set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∫–æ–º–Ω–∞—Ç—ã }));
  }, []);

  const –Ω–∞_–æ—à–∏–±–∫—É = useCallback((–æ—à–∏–±–∫–∞: string) => {
    console.log(`[page.tsx] ‚ùå –ü–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞ –æ—Ç useSocket:`, –æ—à–∏–±–∫–∞);
    set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –æ—à–∏–±–∫–∞ }));
    –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ(`–û—à–∏–±–∫–∞: ${–æ—à–∏–±–∫–∞}`);
  }, [–ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]);

  const socketAPI = useSocket({
    —Å–µ—Ä–≤–µ—ÄUrl: webSocketURL,
    –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
    –Ω–∞_–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ_–∫–æ–º–Ω–∞—Ç,
    –Ω–∞_–æ—à–∏–±–∫—É,
  });

  // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
  const {
    socket,
    –ø–æ–¥–∫–ª—é—á–µ–Ω–æ,
    –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
    –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è_–∫_–∫–æ–º–Ω–∞—Ç–µ,
    –ø–æ–∫–∏–Ω—É—Ç—å_–∫–æ–º–Ω–∞—Ç—É,
    –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
  } = socketAPI;

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  useEffect(() => {
    console.log(`[page.tsx] üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:`, {
      –ø–æ–¥–∫–ª—é—á–µ–Ω–æ: –ø–æ–¥–∫–ª—é—á–µ–Ω–æ,
      –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
      socket: !!socket,
      socketReadyState: socket?.readyState,
      –ø—Ä–µ–¥—ã–¥—É—â–µ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ: {
        –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
        –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
      }
    });
    
    // –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
    if (–ø–æ–¥–∫–ª—é—á–µ–Ω–æ && –º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É) {
      console.log(`[page.tsx] ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏`);
      set–ú–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É(false);
    }
    
    set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => {
      const –Ω–æ–≤–æ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ = {
        ...prev,
        –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: –ø–æ–¥–∫–ª—é—á–µ–Ω–æ,
        –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
      };
      
      console.log(`[page.tsx] üìù –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:`, {
        –±—ã–ª–æ: {
          –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: prev.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
          –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: prev.–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
        },
        —Å—Ç–∞–ª–æ: {
          –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: –Ω–æ–≤–æ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
          –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: –Ω–æ–≤–æ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
        }
      });
      
      return –Ω–æ–≤–æ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ;
    });
  }, [–ø–æ–¥–∫–ª—é—á–µ–Ω–æ, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç, socket, –º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É]);

  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
  const –æ—Ç–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = useCallback(() => {
    set–ü–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏(true);
    –≤–∏–±—Ä–∞—Ü–∏—è?.();
  }, [–≤–∏–±—Ä–∞—Ü–∏—è]);

  const –∑–∞–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = useCallback(() => {
    set–ü–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏(false);
  }, []);

  const —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–∏_–∑–∞–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = useCallback((–Ω–æ–≤—ã–µ_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏: typeof –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) => {
    —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏(–Ω–æ–≤—ã–µ_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏);
    set–ü–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏(false);
    –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?.('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
  }, [—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]);


  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–Ω–∞—Ç
  const –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ_–∫_–∫–æ–º–Ω–∞—Ç–µ = useCallback(async (–∫–æ–º–Ω–∞—Ç–∞_id: string, –ø–∞—Ä–æ–ª—å?: string) => {
    if (!—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) return;

    try {
      –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è_–∫_–∫–æ–º–Ω–∞—Ç–µ(–∫–æ–º–Ω–∞—Ç–∞_id, –ø–∞—Ä–æ–ª—å);
      –≤–∏–±—Ä–∞—Ü–∏—è();

      const –∫–æ–º–Ω–∞—Ç–∞ = —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∫–æ–º–Ω–∞—Ç—ã.find(r => r.id === –∫–æ–º–Ω–∞—Ç–∞_id);
      if (–∫–æ–º–Ω–∞—Ç–∞) {
        set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: –∫–æ–º–Ω–∞—Ç–∞ }));
      }
    } catch (error) {
      –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ');
    }
  }, [—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∫–æ–º–Ω–∞—Ç—ã, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è_–∫_–∫–æ–º–Ω–∞—Ç–µ, –≤–∏–±—Ä–∞—Ü–∏—è, –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]);

  const –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–≤—ã—Ö–æ–¥_–∏–∑_–∫–æ–º–Ω–∞—Ç—ã = useCallback(async () => {
    if (!—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å || !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞) return;

    const –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ = await –ø–æ–∫–∞–∑–∞—Ç—å–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É?');
    if (!–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ) return;

    try {
      –ø–æ–∫–∏–Ω—É—Ç—å_–∫–æ–º–Ω–∞—Ç—É(—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞.id);
      set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: null }));
      –≤–∏–±—Ä–∞—Ü–∏—è();
      –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ('–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –∫–æ–º–Ω–∞—Ç—É');
    } catch (error) {
      –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É');
    }
  }, [—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞, –ø–æ–∫–∏–Ω—É—Ç—å_–∫–æ–º–Ω–∞—Ç—É, –≤–∏–±—Ä–∞—Ü–∏—è, –ø–æ–∫–∞–∑–∞—Ç—å–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ WebSocket
  useEffect(() => {
    if (!socket || !socket.–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è) return;

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ
    const unsubscribe–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ = socket.–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è('–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è-–∫-–∫–æ–º–Ω–∞—Ç–µ', (–¥–∞–Ω–Ω—ã–µ: any) => {
      const { –∫–æ–º–Ω–∞—Ç–∞ } = –¥–∞–Ω–Ω—ã–µ;
      set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: –∫–æ–º–Ω–∞—Ç–∞ }));
      –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–Ω–∞—Ç—É \"${–∫–æ–º–Ω–∞—Ç–∞.–Ω–∞–∑–≤–∞–Ω–∏–µ}\"!`);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
    const unsubscribe–í—ã—Ö–æ–¥ = socket.–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è('–ø–æ–∫–∏–Ω—É–ª-–∫–æ–º–Ω–∞—Ç—É', (–¥–∞–Ω–Ω—ã–µ: any) => {
      set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: null }));
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
    const unsubscribe–°–æ–∑–¥–∞–Ω–∏–µ = socket.–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è('–∫–æ–º–Ω–∞—Ç–∞-—Å–æ–∑–¥–∞–Ω–∞', (–¥–∞–Ω–Ω—ã–µ: any) => {
      const { –∫–æ–º–Ω–∞—Ç–∞ } = –¥–∞–Ω–Ω—ã–µ;
      if (–∫–æ–º–Ω–∞—Ç–∞.—Å–æ–∑–¥–∞—Ç–µ–ª—å === —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?.id) {
        set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: –∫–æ–º–Ω–∞—Ç–∞ }));
      }
    });

    return () => {
      unsubscribe–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ();
      unsubscribe–í—ã—Ö–æ–¥();
      unsubscribe–°–æ–∑–¥–∞–Ω–∏–µ();
    };
  }, [socket, —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?.id, –ø–æ–∫–∞–∑–∞—Ç—å–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]);

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  if (—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è || !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å || !–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–∑–∞–≥—Ä—É–∂–µ–Ω—ã) {
    return (
      <div className="min-h-screen bg-[var(--bg-primary)] flex items-center justify-center">
        <div className="text-center space-y-4">
          <div className="w-16 h-16 mx-auto rounded-full bg-[var(--bg-secondary)] flex items-center justify-center">
            <div className="w-8 h-8 rounded-full border-2 border-[var(--accent)] border-t-transparent animate-spin"></div>
          </div>
          <div className="text-lg font-medium text-[var(--text-primary)]">
            –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã
          </div>
          <div className="text-sm text-[var(--text-secondary)]">
            –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...
          </div>
        </div>
      </div>
    );
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å race condition)
  const —É—Å–ª–æ–≤–∏–µ_–æ—à–∏–±–∫–∏ = !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É && !–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç && –º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É;
  console.log(`[page.tsx] üö® –î–ï–¢–ê–õ–¨–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:`, {
    '—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É': —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
    '–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç': –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
    '–º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É': –º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å_–æ—à–∏–±–∫—É,
    'socket —Å—É—â–µ—Å—Ç–≤—É–µ—Ç': !!socket,
    'socket?.readyState': socket?.readyState,
    'WebSocket.OPEN': WebSocket.OPEN,
    'WebSocket.CONNECTING': WebSocket.CONNECTING,
    'WebSocket.CLOSING': WebSocket.CLOSING,
    'WebSocket.CLOSED': WebSocket.CLOSED,
    'socket === WebSocket.OPEN': socket?.readyState === WebSocket.OPEN,
    'socket === WebSocket.CONNECTING': socket?.readyState === WebSocket.CONNECTING,
    '—É—Å–ª–æ–≤–∏–µ_–æ—à–∏–±–∫–∏ (!–ø–æ–¥–∫–ª—é—á–µ–Ω–æ && !–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è && –º–æ–∂–Ω–æ_–ø–æ–∫–∞–∑–∞—Ç—å)': —É—Å–ª–æ–≤–∏–µ_–æ—à–∏–±–∫–∏,
    '–ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É': !—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
    '–ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–æ–∫–µ—Ç': !–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
    '—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å': —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ? {
      id: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.id,
      –∏–º—è: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–º—è
    } : null
  });
  
  if (—É—Å–ª–æ–≤–∏–µ_–æ—à–∏–±–∫–∏) {
    console.log(`[page.tsx] ‚ùå –ü–û–ö–ê–ó–´–í–ê–ï–ú –≠–ö–†–ê–ù –û–®–ò–ë–ö–ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø`);
    console.log(`[page.tsx] üìä –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:`, {
      ...—Å–æ—Å—Ç–æ—è–Ω–∏–µ,
      —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ? {
        id: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.id,
        –∏–º—è: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–º—è
      } : null
    });
    return (
      <div className="min-h-screen bg-[var(--bg-primary)] flex items-center justify-center p-4">
        <div className="text-center space-y-4 max-w-md">
          <div className="w-16 h-16 mx-auto rounded-full bg-[var(--danger)] bg-opacity-10 flex items-center justify-center">
            <svg className="w-8 h-8 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div className="text-lg font-medium text-[var(--text-primary)]">
            –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
          </div>
          <div className="text-sm text-[var(--text-secondary)]">
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞
          </div>
          <button
            onClick={() => window.location.reload()}
            className="px-4 py-2 bg-[var(--bg-secondary)] hover:bg-[var(--bg-hover)] text-[var(--text-primary)] rounded-lg transition-colors border border-[var(--border-color)]"
          >
            –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
          </button>
        </div>
      </div>
    );
  }

  console.log(`[page.tsx] ‚úÖ –†–ï–ù–î–ï–†–ò–ú –ù–û–†–ú–ê–õ–¨–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–°`);
  console.log(`[page.tsx] üéØ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞:`, {
    –ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É,
    –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç,
    –∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞?.–Ω–∞–∑–≤–∞–Ω–∏–µ,
    –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∫–æ–º–Ω–∞—Ç: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∫–æ–º–Ω–∞—Ç—ã.length,
    —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?.–∏–º—è
  });

  return (
    <div className="min-h-screen bg-[var(--bg-primary)]">
      {/* –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */}
      <div className="border-b border-[var(--border-color)]">
        <div className="max-w-4xl mx-auto px-6 py-2 flex items-center justify-between text-xs">
          <div className="flex items-center gap-2">
            <div className={`w-2 h-2 rounded-full ${—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É ? 'bg-[var(--success)]' : 'bg-[var(--warning)]'} animate-pulse`}></div>
            <span className="text-[var(--text-secondary)]">
              {—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–ø–æ–¥–∫–ª—é—á–µ–Ω–æ_–∫_—Å–µ—Ä–≤–µ—Ä—É ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...'}
            </span>
          </div>
          <div className="text-[var(--text-tertiary)]">
            v{—Ç–µ–ª–µ–≥—Ä–∞–º_–≤–µ—Ä—Å–∏—è}
          </div>
        </div>
      </div>

      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
      {—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞ ? (
        <SimpleVoiceRoom
          key={`room-${—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞.id}`} // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–π
          –∫–æ–º–Ω–∞—Ç–∞={—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∞–∫—Ç–∏–≤–Ω–∞—è_–∫–æ–º–Ω–∞—Ç–∞}
          —Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å={—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}
          socket={socketAPI}
          –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è={–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è}
          –Ω–∞_–ø–æ–∫–∏–Ω—É—Ç—å_–∫–æ–º–Ω–∞—Ç—É={–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–≤—ã—Ö–æ–¥_–∏–∑_–∫–æ–º–Ω–∞—Ç—ã}
          –Ω–∞_–æ—Ç–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏={–æ—Ç–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
        />
      ) : (
        <SimpleRoomsList
          –∫–æ–º–Ω–∞—Ç—ã={—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–∫–æ–º–Ω–∞—Ç—ã}
          –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å={—Å–æ—Å—Ç–æ—è–Ω–∏–µ.—Ç–µ–∫—É—â–∏–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}
          –Ω–∞_–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ={–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ_–∫_–∫–æ–º–Ω–∞—Ç–µ}
          –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è={–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è_—Å–æ–∫–µ—Ç}
          –Ω–∞_–æ—Ç–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏={–æ—Ç–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
        />
      )}

      {/* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */}
      {–ø–æ–∫–∞–∑–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ && (
        <SettingsPage
          –Ω–∞—Å—Ç—Ä–æ–π–∫–∏={–Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
          –Ω–∞_–∑–∞–∫—Ä—ã—Ç—å={–∑–∞–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
          –Ω–∞_—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å={—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–∏_–∑–∞–∫—Ä—ã—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
        />
      )}

      {/* Debug Modal */}
      <DebugModal
        –æ—Ç–∫—Ä—ã—Ç={–ø–æ–∫–∞–∑–∞—Ç—å_–æ—Ç–ª–∞–¥–∫—É}
        –Ω–∞_–∑–∞–∫—Ä—ã—Ç—å={–∑–∞–∫—Ä—ã—Ç—å_–æ—Ç–ª–∞–¥–∫—É}
      />

      {/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ */}
      {—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–æ—à–∏–±–∫–∞ && (
        <div className="fixed bottom-4 left-4 right-4 max-w-md mx-auto">
          <div className="bg-[var(--bg-primary)] border border-[var(--danger)] rounded-lg shadow-[var(--shadow-md)] p-4">
            <div className="flex items-start justify-between gap-3">
              <div className="flex items-start gap-3">
                <div className="w-5 h-5 rounded-full bg-[var(--danger)] bg-opacity-10 flex-shrink-0 flex items-center justify-center mt-0.5">
                  <svg className="w-3 h-3 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </div>
                <div className="text-sm text-[var(--text-primary)]">{—Å–æ—Å—Ç–æ—è–Ω–∏–µ.–æ—à–∏–±–∫–∞}</div>
              </div>
              <button
                onClick={() => set–°–æ—Å—Ç–æ—è–Ω–∏–µ(prev => ({ ...prev, –æ—à–∏–±–∫–∞: null }))}
                className="text-[var(--text-tertiary)] hover:text-[var(--text-secondary)] transition-colors"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
